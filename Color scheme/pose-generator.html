<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒãƒ¼ã‚ºãƒ»æ§‹å›³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ - Palette Generator Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #7c3aed; --shadow: 0 8px 32px rgba(31,38,135,0.15); }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html.dark body  { background: linear-gradient(160deg,#0d0d14 0%,#111118 100%); color: #e8eaf0; }
    html.light body { background: #f5f3ff; color: #1a1a2e; }
    html.dark  body { background: linear-gradient(180deg,#0c0c0c 0%,#151515 100%); color: #eaeaea; }
    body { font-family: 'DM Sans', sans-serif; padding: 24px 20px 80px; min-height: 100vh; transition: background 0.3s, color 0.3s; }

    .container { max-width: 900px; margin: 0 auto; }

    .page-header { margin-bottom: 32px; }
    .page-header h1 {
      font-family: 'Syne', sans-serif;
      font-size: 2.2rem;
      background: linear-gradient(45deg, #7c3aed, #06b6d4);
      -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
    }
    .page-header p { opacity: .6; margin-top: 6px; font-size: 14px; }

    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      border-radius: 20px; padding: 28px; margin-bottom: 20px;
      box-shadow: var(--shadow); border: 1px solid; transition: box-shadow 0.3s;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    }
    html.light body .card { background: rgba(255,255,255,0.92); border-color: rgba(0,0,0,0.07); }
    html.dark  body .card { background: rgba(25,25,25,0.88); border-color: rgba(255,255,255,0.06); }
    .card:hover { box-shadow: 0 16px 48px rgba(124,58,237,0.15); }
    .card-title {
      font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700;
      margin-bottom: 20px; display: flex; align-items: center; gap: 8px;
    }

    /* ãƒœã‚¿ãƒ³ */
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
    .btn {
      padding: 11px 22px; border: none; border-radius: 10px;
      font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600;
      cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
      text-decoration: none;
    }
    .btn:hover { transform: translateY(-2px); opacity: .92; }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-cyan    { background: #06b6d4; color: #fff; }
    .btn-orange  { background: #f59e0b; color: #fff; }
    .btn-gray    { background: #6c757d; color: #fff; }
    .btn-green   { background: #10b981; color: #fff; }

    /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒƒãƒ— */
    .chip-wrap { display: flex; flex-wrap: wrap; gap: 7px; margin-bottom: 16px; }
    .chip {
      padding: 5px 14px; border-radius: 20px; font-size: 13px; font-weight: 600;
      border: 2px solid rgba(124,58,237,0.3); background: transparent; color: inherit;
      cursor: pointer; transition: all 0.2s; user-select: none; font-family: 'DM Sans', sans-serif;
    }
    .chip.active { background: var(--primary); border-color: var(--primary); color: #fff; }
    .chip:hover:not(.active) { border-color: var(--primary); background: rgba(124,58,237,0.1); }

    /* çµæœã‚«ãƒ¼ãƒ‰ */
    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 14px;
      margin-top: 4px;
    }
    .result-card {
      background: rgba(124,58,237,0.07);
      border: 1px solid rgba(124,58,237,0.18);
      border-radius: 14px; padding: 16px;
      transition: transform 0.2s;
    }
    .result-card:hover { transform: translateY(-2px); }
    .result-card h4 {
      font-size: 11px; font-weight: 700; letter-spacing: .07em; opacity: .5;
      text-transform: uppercase; margin-bottom: 8px;
    }
    .result-card .val { font-size: 15px; font-weight: 600; line-height: 1.4; }

    /* å‡ºåŠ›ã‚¨ãƒªã‚¢ */
    .output-area {
      min-height: 100px;
      border: 2px dashed rgba(124,58,237,0.25);
      border-radius: 14px; padding: 20px;
      font-size: 14px; line-height: 1.8;
    }
    .output-placeholder { opacity: .45; font-size: 14px; }

    /* ãƒ­ãƒƒã‚¯ */
    .lock-toggle {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600;
      border: 2px solid rgba(245,158,11,0.4); background: transparent; color: inherit;
      cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif;
    }
    .lock-toggle.locked { background: rgba(245,158,11,0.15); border-color: #f59e0b; color: #f59e0b; }

    /* å±¥æ­´ */
    .history-list { display: flex; flex-direction: column; gap: 8px; max-height: 280px; overflow-y: auto; }
    .history-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 14px; border-radius: 10px;
      background: rgba(124,58,237,0.06); border: 1px solid rgba(124,58,237,0.12);
      font-size: 13px; gap: 10px;
    }
    .history-item .hist-text { flex: 1; opacity: .8; }
    .history-item .hist-copy {
      padding: 4px 10px; border: none; border-radius: 6px;
      background: var(--primary); color: #fff; font-size: 12px; font-weight: 600;
      cursor: pointer; white-space: nowrap; font-family: 'DM Sans', sans-serif;
    }

    /* ãƒˆãƒ¼ã‚¹ãƒˆ */
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.85); color: #fff; padding: 12px 24px;
      border-radius: 50px; opacity: 0; pointer-events: none; transition: all 0.3s; z-index: 2000;
    }
    .toast.show { opacity: 1; bottom: 42px; }

    @media (max-width: 600px) {
      .page-header h1 { font-size: 1.7rem; }
      .result-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
    }
  </style>
  <script>
    (function(){
      const t = localStorage.getItem("theme") ||
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      document.documentElement.className = t;
    })();
  </script>
</head>
<body>

<div id="mainNav"></div>
<div id="toast" class="toast"></div>

<div class="container">
  <div class="page-header">
    <h1>ğŸ§ ãƒãƒ¼ã‚ºãƒ»æ§‹å›³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p>ã‚¤ãƒ©ã‚¹ãƒˆãƒ»ãƒãƒ³ã‚¬åˆ¶ä½œã®ãŸã‚ã®ãƒãƒ¼ã‚ºãƒ»ã‚¢ãƒ³ã‚°ãƒ«ãƒ»æ§‹å›³ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã—ã¾ã™</p>
  </div>

  <!-- ========== ãƒãƒ¼ã‚º ========== -->
  <div class="card">
    <div class="card-title">ğŸ§ ãƒãƒ¼ã‚ºç”Ÿæˆ</div>

    <div style="font-size:13px;font-weight:600;margin-bottom:8px;">ãƒãƒ¼ã‚ºã‚«ãƒ†ã‚´ãƒªï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</div>
    <div class="chip-wrap" id="poseCatWrap">
      <button class="chip active" data-cat="standing">ğŸ§ ç«‹ã¡</button>
      <button class="chip active" data-cat="sitting">ğŸª‘ åº§ã‚Š</button>
      <button class="chip active" data-cat="action">ğŸƒ å‹•ããƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</button>
      <button class="chip active" data-cat="emotion">ğŸ˜­ æ„Ÿæƒ…è¡¨ç¾</button>
      <button class="chip active" data-cat="special">âœ¨ ç‰¹æ®Šãƒ»ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼</button>
    </div>

    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
      <div style="font-size:13px;font-weight:600;">ç”Ÿæˆæ•°:</div>
      <select id="poseCount" style="padding:7px 12px;border-radius:8px;border:1px solid rgba(128,128,128,.3);background:rgba(255,255,255,.08);color:inherit;font-family:'DM Sans',sans-serif;font-size:13px;">
        <option value="1" selected>1å€‹</option>
        <option value="2">2å€‹</option>
        <option value="3">3å€‹</option>
        <option value="5">5å€‹</option>
      </select>
      <button class="lock-toggle" id="poseLockBtn" onclick="togglePoseLock()">ğŸ”“ ãƒ­ãƒƒã‚¯è§£é™¤ä¸­</button>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="genPoses()">ğŸ² ãƒãƒ¼ã‚ºã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ</button>
      <button class="btn btn-gray"    onclick="copyResult('poseOutput')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="output-area" id="poseOutput">
      <div class="output-placeholder">ã€Œãƒãƒ¼ã‚ºã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
    </div>
  </div>

  <!-- ========== æ§‹å›³ ========== -->
  <div class="card">
    <div class="card-title">ğŸ–¼ï¸ æ§‹å›³ãƒ»ã‚¢ãƒ³ã‚°ãƒ«ç”Ÿæˆ</div>

    <div style="font-size:13px;font-weight:600;margin-bottom:8px;">ç”Ÿæˆã™ã‚‹é …ç›®</div>
    <div class="chip-wrap" id="compItemWrap">
      <button class="chip active" data-item="angle">ğŸ“ ã‚¢ãƒ³ã‚°ãƒ«</button>
      <button class="chip active" data-item="distance">ğŸ“ è·é›¢æ„Ÿ</button>
      <button class="chip active" data-item="framing">ğŸï¸ ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°</button>
      <button class="chip active" data-item="lighting">ğŸ’¡ ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°</button>
      <button class="chip active" data-item="perspective">ğŸŒ€ ãƒ‘ãƒ¼ã‚¹</button>
      <button class="chip active" data-item="mood">ğŸŒ™ é›°å›²æ°—</button>
    </div>

    <div class="btn-row">
      <button class="btn btn-cyan"  onclick="genComposition()">ğŸ–¼ï¸ æ§‹å›³ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ</button>
      <button class="btn btn-gray"  onclick="copyResult('compOutput')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="output-area" id="compOutput">
      <div class="output-placeholder">ã€Œæ§‹å›³ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
    </div>
  </div>

  <!-- ========== ã¾ã¨ã‚ã¦ç”Ÿæˆ ========== -->
  <div class="card">
    <div class="card-title">âœ¨ ãƒãƒ¼ã‚ºï¼‹æ§‹å›³ã¾ã¨ã‚ã¦ç”Ÿæˆ</div>
    <p style="font-size:13px;opacity:.65;margin-bottom:16px;">ä¸Šè¨˜ã®è¨­å®šã‚’ã¾ã¨ã‚ã¦ä¸€åº¦ã«ç”Ÿæˆã—ã¾ã™ã€‚ã‚¤ãƒ©ã‚¹ãƒˆç™ºæ³¨æ›¸ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ã«ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ã§ãã¾ã™ã€‚</p>
    <div class="btn-row">
      <button class="btn btn-orange" onclick="genAll()">âœ¨ ã¾ã¨ã‚ã¦ç”Ÿæˆ</button>
      <button class="btn btn-green"  onclick="copyResult('allOutput')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
    <div class="output-area" id="allOutput">
      <div class="output-placeholder">ã€Œã¾ã¨ã‚ã¦ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
    </div>
  </div>

  <!-- ========== å±¥æ­´ ========== -->
  <div class="card">
    <div class="card-title">ğŸ“ ç”Ÿæˆå±¥æ­´ï¼ˆç›´è¿‘10ä»¶ï¼‰</div>
    <div class="history-list" id="historyList">
      <div class="output-placeholder" style="font-size:13px;">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
    </div>
  </div>
</div>

<script src="auth.js"></script>
<script src="common.js"></script>
<script>
// ==================== ãƒ‡ãƒ¼ã‚¿ ====================

const POSES = {
  standing: [
    'ç›´ç«‹ãƒ»æ°—ã‚’ã¤ã‘', 'ç‰‡è¶³é‡å¿ƒï¼ˆç‰‡æ‰‹è…°ï¼‰', 'è…°ã«ä¸¡æ‰‹ã‚’å½“ã¦ã‚‹', 'è…•ã‚’çµ„ã‚€', 'æ‰‹ã‚’æŒ¯ã‚‹ï¼ˆç‰‡æ‰‹ï¼‰',
    'ä¸¡æ‰‹ã‚’æŒ¯ã‚‹', 'ã‚¬ãƒƒãƒ„ãƒãƒ¼ã‚ºï¼ˆç‰‡æ‰‹ï¼‰', 'ä¸¡æ‰‹ã‚¬ãƒƒãƒ„ãƒãƒ¼ã‚º', 'ä¸¡æ‰‹ã‚’åºƒã’ã‚‹', 'ä½“ã‚’å‚¾ã‘ã‚‹',
    'ç‰‡æ‰‹ã‚’ä¸Šã’ã‚‹', 'æ·±å‘¼å¸ã™ã‚‹', 'èƒŒç­‹ã‚’ä¼¸ã°ã—ã¦ã®ã‘ãã‚‹', 'å‰ã‹ãŒã¿', 'å£ã«ã‚‚ãŸã‚Œã‚‹',
    'æŸ±ã«æ‰‹ã‚’ã¤ã', 'ãƒã‚±ãƒƒãƒˆã«æ‰‹ã‚’å…¥ã‚Œã‚‹', 'é¦–ã‚’ã‹ã—ã’ã‚‹', 'è‚©ã‚’ã™ãã‚ã‚‹', 'ç‰‡è†ç«‹ã¦',
    'æ•¬ç¤¼', 'ãŠã˜ã', 'ã¤ã¾å…ˆç«‹ã¡', 'å¾Œã‚æ‰‹ã‚’çµ„ã‚€', 'ä¸¡æ‰‹ã‚’åˆã‚ã›ã¦ç¥ˆã‚‹',
  ],
  sitting: [
    'æ¤…å­ã«åº§ã‚‹ï¼ˆå‰ã®ã‚ã‚Šï¼‰', 'æ¤…å­ã«èƒŒã‚‚ãŸã‚Œå¯„ã‚Šã‹ã‹ã‚Š', 'ã‚ãã‚‰', 'ä½“è‚²åº§ã‚Š', 'æ¨ªåº§ã‚Š',
    'è†ã‚’æŠ±ãˆã‚‹', 'åºŠã«ç‰‡è†ç«‹ã¦åº§ã‚Š', 'ã‚½ãƒ•ã‚¡ã«è„šã‚’ä¼¸ã°ã™', 'è¶³ã‚’çµ„ã‚€', 'æ¤…å­ã«æ¨ªå‘ãã«åº§ã‚‹',
    'åºŠã«å€’ã‚Œè¾¼ã‚€ã‚ˆã†ã«åº§ã‚‹', 'ãƒ†ãƒ¼ãƒ–ãƒ«ã«è‚˜ã‚’ã¤ã', 'åºŠã«æ‰‹ã‚’ã¤ã', 'èƒ¡åã§è…•ã‚’çµ„ã‚€',
  ],
  action: [
    'èµ°ã‚‹ï¼ˆå‰æ–¹ï¼‰', 'èµ°ã‚‹ï¼ˆæŒ¯ã‚Šè¿”ã‚Šï¼‰', 'ã‚¸ãƒ£ãƒ³ãƒ—ï¼ˆä¸¡è¶³ï¼‰', 'ç‰‡è¶³ã‚¸ãƒ£ãƒ³ãƒ—', 'ç©ºä¸­ã§ä½“ã‚’ä¸¸ã‚ã‚‹',
    'ã—ã‚ƒãŒã‚€', 'æ€¥åœæ­¢', 'æŒ¯ã‚Šè¿”ã‚‹', 'æ»‘ã‚‹', 'æ³³ãï¼ˆå¹³æ³³ãï¼‰', 'è¸Šã‚‹', 'è¹´ã‚Šä¸Šã’ã‚‹',
    'æŠ¼ã™', 'å¼•ã', 'ç‰©ã‚’æ‹¾ã†', 'ç‰©ã‚’æŒã¡ä¸Šã’ã‚‹', 'ãƒ‰ãƒªãƒ•ãƒˆ', 'å€’ã‚ŒãªãŒã‚‰æ‰‹ã‚’ä¼¸ã°ã™',
    'å®™è¿”ã‚Š', 'å£ã‚’è¹´ã£ã¦è·³ã¶', 'åœ°é¢ã‚’è»¢ãŒã‚‹', 'å´–ã«ã¶ã‚‰ä¸‹ãŒã‚‹',
  ],
  emotion: [
    'é©šã„ã¦å¾Œé€€', 'å–œã‚“ã§è·³ã³ä¸ŠãŒã‚‹', 'æ‚²ã—ã‚“ã§ã†ãšãã¾ã‚‹', 'æ€’ã£ã¦æŒ‡ã‚’å·®ã™', 'ç…§ã‚Œã¦é¡”ã‚’éš ã™',
    'ç¬‘ã£ã¦è»¢ãŒã‚‹', 'æ³£ãå´©ã‚Œã‚‹', 'ã»ã£ã¨ã—ã¦è‚©ã®åŠ›ã‚’æŠœã', 'é ­ã‚’æŠ±ãˆã‚‹', 'å¤©ã‚’ä»°ã',
    'è†ã‹ã‚‰å´©ã‚Œè½ã¡ã‚‹', 'æ­“å–œã§æŠ±ãåˆã†', 'ã†ã‚Œã—æ³£ã', 'æ‚”ã—ãã¦åœ°é¢ã‚’å©ã',
    'ç„¦ã£ã¦èµ°ã‚Šå›ã‚‹', 'ãŠã©ãŠã©ã¨è¦–ç·šã‚’é€¸ã‚‰ã™', 'è‡ªä¿¡æº€ã€…ã«èƒ¸ã‚’å¼µã‚‹',
  ],
  special: [
    'é­”æ³•ã‚’ä½¿ã†ï¼ˆæ‰‹ã‹ã‚‰æ”¾ã¤ï¼‰', 'å¤‰èº«ãƒãƒ¼ã‚º', 'æ­¦å™¨ã‚’é«˜ãæ²ã’ã‚‹', 'å®ˆã‚Šã®å§¿å‹¢ï¼ˆç›¾æ§‹ãˆï¼‰',
    'ç©ºä¸­ã«æµ®ã‹ã¶', 'ç©ºã‚’è¦‹ä¸Šã’ã‚‹ï¼ˆè¦šé†’ï¼‰', 'åŠ›ã‚’æºœã‚ã‚‹ï¼ˆãƒãƒ£ãƒ¼ã‚¸ï¼‰', 'æŠ€åã‚’å«ã¶',
    'åœ°ã«ä¼ã—æ‰‹ã‚’ä¼¸ã°ã™', 'ä»²é–“ã¨èƒŒä¸­åˆã‚ã›', 'ä»²é–“ã¨æ‰‹ã‚’ã¤ãªã', 'å‹åˆ©ã®ãƒãƒ¼ã‚ºï¼ˆæ±ºã‚ãƒãƒ¼ã‚ºï¼‰',
    'æ•—åŒ—ãƒ»å€’ã‚Œã‚‹', 'åˆ€ã‚’é˜ã«åã‚ã‚‹', 'ç¾½ã‚’åºƒã’ã¦é™ã‚Šç«‹ã¤', 'å…‰ã«åŒ…ã¾ã‚Œã‚‹',
  ],
};

const COMPOSITIONS = {
  angle: [
    'æ­£é¢', 'æ–œã‚45Â°ï¼ˆå³ï¼‰', 'æ–œã‚45Â°ï¼ˆå·¦ï¼‰', 'çœŸæ¨ª', 'èƒŒé¢', 'æ–œã‚å¾Œæ–¹ï¼ˆå³ï¼‰',
    'ä¿¯ç°ï¼ˆä¸Šã‹ã‚‰60Â°ï¼‰', 'çœŸä¸Šï¼ˆçœŸä¿¯ç°ï¼‰', 'ã‚¢ã‚ªãƒªï¼ˆä¸‹ã‹ã‚‰30Â°ï¼‰', 'ã‚¢ã‚ªãƒªï¼ˆä¸‹ã‹ã‚‰60Â°ï¼‰',
    'æ¥µç«¯ãªã‚¢ã‚ªãƒªï¼ˆã»ã¼çœŸä¸‹ï¼‰', 'ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ³ã‚°ãƒ«ï¼ˆå‚¾ãï¼‰',
  ],
  distance: [
    'ãƒ•ãƒ«ã‚·ãƒ§ãƒƒãƒˆï¼ˆå…¨èº«ï¼‰', 'ãƒ‹ãƒ¼ã‚·ãƒ§ãƒƒãƒˆï¼ˆè†ä¸Šï¼‰', 'ã‚¦ã‚¨ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆï¼ˆè…°ä¸Šï¼‰',
    'ãƒã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆï¼ˆèƒ¸ä¸Šï¼‰', 'ã‚¯ãƒ­ãƒ¼ã‚ºã‚¢ãƒƒãƒ—ï¼ˆé¡”ã®ã¿ï¼‰', 'ã‚¨ã‚¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚¯ãƒ­ãƒ¼ã‚ºã‚¢ãƒƒãƒ—ï¼ˆç›®ãƒ»å£ãªã©ï¼‰',
    'ãƒ­ãƒ³ã‚°ã‚·ãƒ§ãƒƒãƒˆï¼ˆå¼•ãï¼‰', 'ã‚¨ã‚¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ­ãƒ³ã‚°ã‚·ãƒ§ãƒƒãƒˆï¼ˆè¶…å¼•ããƒ»ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼‰',
    'ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ï¼ˆè‚©è¶Šã—ï¼‰',
  ],
  framing: [
    'ä¸­å¤®é…ç½®', 'ä¸‰åˆ†å‰²ãƒ»å³å¯„ã‚Š', 'ä¸‰åˆ†å‰²ãƒ»å·¦å¯„ã‚Š', 'ä¸‰åˆ†å‰²ãƒ»ä¸Šå¯„ã‚Š', 'ä¸‰åˆ†å‰²ãƒ»ä¸‹å¯„ã‚Š',
    'å¯¾è§’ç·šï¼ˆå³ä¸Šã‹ã‚‰å·¦ä¸‹ï¼‰', 'å¯¾è§’ç·šï¼ˆå·¦ä¸Šã‹ã‚‰å³ä¸‹ï¼‰', 'Sãƒ©ã‚¤ãƒ³', 'æ ã‚’ä½¿ã£ãŸé¡ç¸æ§‹å›³',
    'æ”¾å°„çŠ¶ï¼ˆè¦–ç·šãŒä¸­å¿ƒã¸ï¼‰', 'ç”»é¢ã‹ã‚‰ä½“ãŒã¯ã¿å‡ºã™', 'èƒŒæ™¯ã®ã¿ï¼ˆäººç‰©ãªã—ï¼‰',
    'ã‚·ãƒ«ã‚¨ãƒƒãƒˆ', 'å·¦å³å¯¾ç§°', 'ãƒ­ã®å­—æ§‹å›³', 'ä¸‰è§’æ§‹å›³',
  ],
  lighting: [
    'æ­£é¢å…‰ï¼ˆãƒ•ãƒ©ãƒƒãƒˆï¼‰', 'æ–œã‚å…‰ï¼ˆ45Â°ã‚µã‚¤ãƒ‰ï¼‰', 'çœŸæ¨ªã®ã‚µã‚¤ãƒ‰å…‰ï¼ˆæ˜æš—äºŒåˆ†ï¼‰',
    'é€†å…‰ï¼ˆãƒãƒƒã‚¯ãƒ©ã‚¤ãƒˆï¼‰', 'ãƒªãƒ ãƒ©ã‚¤ãƒˆï¼ˆç¸å–ã‚Šå…‰ï¼‰', 'ä¸Šã‹ã‚‰ã®å…‰ï¼ˆé ­é ‚å…‰ï¼‰',
    'ä¸‹ã‹ã‚‰ã®å…‰ï¼ˆã‚¢ãƒƒãƒ—ãƒ©ã‚¤ãƒˆãƒ»ãƒ›ãƒ©ãƒ¼ï¼‰', 'ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆ', 'å¤•æš®ã‚Œã®ã‚ªãƒ¬ãƒ³ã‚¸å…‰',
    'å¤œãƒ»æœˆæ˜ã‹ã‚Šï¼ˆé’ç™½ã„å…‰ï¼‰', 'è›å…‰ç¯ï¼ˆå®¤å†…ãƒ»å†·ãŸã„å…‰ï¼‰', 'ç‚ã®å…‰ï¼ˆæš–è‰²ãƒ»æºã‚Œï¼‰',
    'é­”æ³•å…‰ï¼ˆç™ºå…‰ä½“ï¼‰', 'ãƒã‚ªãƒ³å…‰ï¼ˆã‚«ãƒ©ãƒ•ãƒ«ï¼‰', 'é€†å…‰ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼‹ãƒªãƒ ãƒ©ã‚¤ãƒˆ',
  ],
  perspective: [
    'ä¸€ç‚¹é€è¦–ï¼ˆæ­£é¢ãƒ»å¥¥è¡Œãï¼‰', 'äºŒç‚¹é€è¦–ï¼ˆæ–œã‚ãƒ»å»ºç‰©ãªã©ï¼‰', 'ä¸‰ç‚¹é€è¦–ï¼ˆã‚¢ã‚ªãƒªãƒ»ä¿¯ç°ï¼‰',
    'é­šçœ¼ï¼ˆåºƒè§’ãƒ»æ­ªã¿ï¼‰', 'æœ›é åœ§ç¸®ï¼ˆå¹³å¦ãƒ»åœ§ç¸®æ„Ÿï¼‰', 'å¹³è¡ŒæŠ•å½±ï¼ˆã‚²ãƒ¼ãƒ é¢¨ï¼‰',
    'ãƒ€ãƒƒãƒã‚¢ãƒ³ã‚°ãƒ«ï¼ˆç”»é¢ã‚’å‚¾ã‘ã‚‹ï¼‰', 'ã‚†ãŒã‚“ã ãƒ‘ãƒ¼ã‚¹ï¼ˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ï¼‰',
  ],
  mood: [
    'ãƒãƒƒãƒ—ãƒ»æ˜ã‚‹ã„', 'ã‚·ãƒªã‚¢ã‚¹ãƒ»é‡åš', 'ãƒ€ãƒ¼ã‚¯ãƒ»ä¸ç©', 'ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãƒ»å¹»æƒ³çš„',
    'ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ãƒ»è¿‘æœªæ¥', 'å’Œé¢¨ãƒ»æ™‚ä»£åŠ‡', 'ãƒ›ãƒ©ãƒ¼ãƒ»ææ€–', 'ã‚³ãƒŸã‚«ãƒ«ãƒ»ã‚®ãƒ£ã‚°',
    'å™æƒ…çš„ãƒ»åˆ‡ãªã„', 'å£®å¤§ãƒ»ã‚¨ãƒ”ãƒƒã‚¯', 'æ—¥å¸¸ãƒ»ã»ã®ã¼ã®', 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯',
    'ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãƒ»è¬ã‚ã„ãŸ', 'ã‚µãƒã‚¤ãƒãƒ«ãƒ»éé…·', 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ãƒ»é­”æ³•',
  ],
};

// ==================== çŠ¶æ…‹ ====================
let poseLocked = false;
let lastPoseResult = null;
let lastCompResult = null;
let history = [];

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

// ==================== ãƒãƒƒãƒ—åˆ‡æ›¿ ====================
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.chip').forEach(chip => {
    chip.addEventListener('click', () => chip.classList.toggle('active'));
  });
});

// ==================== ãƒãƒ¼ã‚ºç”Ÿæˆ ====================
function getActivePoseCats() {
  return [...document.querySelectorAll('#poseCatWrap .chip.active')].map(c => c.dataset.cat);
}

function getActiveCompItems() {
  return [...document.querySelectorAll('#compItemWrap .chip.active')].map(c => c.dataset.item);
}

function togglePoseLock() {
  poseLocked = !poseLocked;
  const btn = document.getElementById('poseLockBtn');
  btn.textContent = poseLocked ? 'ğŸ”’ ãƒ­ãƒƒã‚¯ä¸­ï¼ˆæ¬¡ã®ç”Ÿæˆã§ä¿æŒï¼‰' : 'ğŸ”“ ãƒ­ãƒƒã‚¯è§£é™¤ä¸­';
  btn.classList.toggle('locked', poseLocked);
  showToast(poseLocked ? 'ğŸ”’ ãƒãƒ¼ã‚ºçµæœã‚’ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸ' : 'ğŸ”“ ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¾ã—ãŸ');
}

function genPoses() {
  const cats = getActivePoseCats();
  if (cats.length === 0) { showToast('ã‚«ãƒ†ã‚´ãƒªã‚’1ã¤ä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„'); return; }
  if (poseLocked && lastPoseResult) { showToast('ğŸ”’ ãƒ­ãƒƒã‚¯ä¸­ã§ã™ã€‚è§£é™¤ã—ã¦ã‹ã‚‰ç”Ÿæˆã—ã¦ãã ã•ã„'); return; }

  const count = parseInt(document.getElementById('poseCount').value);
  const results = [];

  for (let i = 0; i < count; i++) {
    const cat = pick(cats);
    const catLabel = { standing:'ç«‹ã¡', sitting:'åº§ã‚Š', action:'å‹•ããƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', emotion:'æ„Ÿæƒ…è¡¨ç¾', special:'ç‰¹æ®Šãƒ»ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼' }[cat];
    results.push({ ã‚«ãƒ†ã‚´ãƒª: catLabel, ãƒãƒ¼ã‚º: pick(POSES[cat]) });
  }

  lastPoseResult = results;
  renderResultCards('poseOutput', results);
  addHistory('ãƒãƒ¼ã‚º', results.map(r => `${r.ã‚«ãƒ†ã‚´ãƒª}: ${r.ãƒãƒ¼ã‚º}`).join(' / '));
}

// ==================== æ§‹å›³ç”Ÿæˆ ====================
function genComposition() {
  const items = getActiveCompItems();
  if (items.length === 0) { showToast('é …ç›®ã‚’1ã¤ä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„'); return; }

  const labelMap = { angle:'ã‚¢ãƒ³ã‚°ãƒ«', distance:'è·é›¢æ„Ÿ', framing:'ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°', lighting:'ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°', perspective:'ãƒ‘ãƒ¼ã‚¹', mood:'é›°å›²æ°—' };
  const result = {};
  items.forEach(item => { result[labelMap[item]] = pick(COMPOSITIONS[item]); });

  lastCompResult = result;
  renderResultCards('compOutput', [result]);
  addHistory('æ§‹å›³', Object.entries(result).map(([k,v]) => `${k}: ${v}`).join(' / '));
}

// ==================== ã¾ã¨ã‚ã¦ç”Ÿæˆ ====================
function genAll() {
  const poseCats = getActivePoseCats();
  const compItems = getActiveCompItems();

  if (poseCats.length === 0 && compItems.length === 0) { showToast('ã‚«ãƒ†ã‚´ãƒªã¾ãŸã¯é …ç›®ã‚’é¸ã‚“ã§ãã ã•ã„'); return; }

  const allData = {};
  const count = parseInt(document.getElementById('poseCount').value);

  if (poseCats.length > 0) {
    if (!poseLocked || !lastPoseResult) {
      const cat = pick(poseCats);
      const catLabel = { standing:'ç«‹ã¡', sitting:'åº§ã‚Š', action:'å‹•ããƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', emotion:'æ„Ÿæƒ…è¡¨ç¾', special:'ç‰¹æ®Šãƒ»ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼' }[cat];
      allData['ãƒãƒ¼ã‚ºã‚«ãƒ†ã‚´ãƒª'] = catLabel;
      allData['ãƒãƒ¼ã‚º'] = pick(POSES[cat]);
      if (count > 1) {
        for (let i = 2; i <= count; i++) {
          const c2 = pick(poseCats);
          const l2 = { standing:'ç«‹ã¡', sitting:'åº§ã‚Š', action:'å‹•ããƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', emotion:'æ„Ÿæƒ…è¡¨ç¾', special:'ç‰¹æ®Šãƒ»ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼' }[c2];
          allData[`ãƒãƒ¼ã‚º${i}ï¼ˆ${l2}ï¼‰`] = pick(POSES[c2]);
        }
      }
    } else {
      lastPoseResult.forEach((r, i) => {
        allData[`ãƒãƒ¼ã‚º${i > 0 ? i+1 : ''}ï¼ˆ${r.ã‚«ãƒ†ã‚´ãƒª}ï¼‰`] = r.ãƒãƒ¼ã‚º;
      });
    }
  }

  const labelMap = { angle:'ã‚¢ãƒ³ã‚°ãƒ«', distance:'è·é›¢æ„Ÿ', framing:'ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°', lighting:'ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°', perspective:'ãƒ‘ãƒ¼ã‚¹', mood:'é›°å›²æ°—' };
  compItems.forEach(item => { allData[labelMap[item]] = pick(COMPOSITIONS[item]); });

  renderResultCards('allOutput', [allData]);
  addHistory('ã¾ã¨ã‚', Object.entries(allData).map(([k,v]) => `${k}: ${v}`).join(' / '));
}

// ==================== æç”» ====================
function renderResultCards(outputId, dataArray) {
  const el = document.getElementById(outputId);
  el.innerHTML = dataArray.map((data, idx) => {
    const entries = Object.entries(data);
    return `
      ${dataArray.length > 1 ? `<div style="font-size:11px;font-weight:700;opacity:.45;letter-spacing:.07em;text-transform:uppercase;margin-bottom:8px;">${idx+1}å€‹ç›®</div>` : ''}
      <div class="result-grid">
        ${entries.map(([k, v]) => `
          <div class="result-card">
            <h4>${k}</h4>
            <div class="val">${v}</div>
          </div>
        `).join('')}
      </div>
    `;
  }).join('<hr style="opacity:.1;margin:16px 0;">');
}

// ==================== ã‚³ãƒ”ãƒ¼ ====================
function copyResult(outputId) {
  const el = document.getElementById(outputId);
  if (el.querySelector('.output-placeholder')) { showToast('å…ˆã«ç”Ÿæˆã—ã¦ãã ã•ã„'); return; }
  const text = [...el.querySelectorAll('.result-card')].map(c => {
    const k = c.querySelector('h4').textContent;
    const v = c.querySelector('.val').textContent;
    return `${k}: ${v}`;
  }).join(' / ');
  navigator.clipboard.writeText(text);
  showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
}

// ==================== å±¥æ­´ ====================
function addHistory(type, text) {
  history.unshift({ type, text, time: new Date().toLocaleTimeString('ja-JP') });
  if (history.length > 10) history.pop();
  renderHistory();
}

function renderHistory() {
  const el = document.getElementById('historyList');
  if (history.length === 0) {
    el.innerHTML = '<div class="output-placeholder" style="font-size:13px;">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
    return;
  }
  el.innerHTML = history.map((h, i) => `
    <div class="history-item">
      <div class="hist-text">
        <span style="opacity:.5;font-size:11px;margin-right:6px;">${h.time}</span>
        <span style="font-size:11px;background:rgba(124,58,237,.15);padding:2px 8px;border-radius:10px;margin-right:6px;">${h.type}</span>
        ${h.text}
      </div>
      <button class="hist-copy" onclick="navigator.clipboard.writeText(\`${h.text.replace(/`/g,"'")}\`);showToast('ã‚³ãƒ”ãƒ¼ï¼')">ğŸ“‹</button>
    </div>
  `).join('');
}

// ==================== ãƒˆãƒ¼ã‚¹ãƒˆ ====================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._t);
  t._t = setTimeout(() => t.classList.remove('show'), 2200);
}

// ==================== åˆæœŸåŒ– ====================
window.onload = () => {
  const user = requireAuth();
  if (!user) return;
  injectCommonStyles();
  buildNav('pose');
};
</script>
</body>
</html>
