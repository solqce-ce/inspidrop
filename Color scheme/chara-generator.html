<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ§‹æˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ - Palette Generator Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #10b981; --shadow: 0 8px 32px rgba(31,38,135,0.15); }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html.dark body  { background: linear-gradient(160deg,#0d0d14 0%,#111118 100%); color: #e8eaf0; }
    html.light body { background: #f0fdf4; color: #1a1a2e; }
    html.dark  body { background: linear-gradient(180deg,#0c0c0c 0%,#151515 100%); color: #eaeaea; }
    body { font-family: 'DM Sans', sans-serif; padding: 24px 20px 80px; min-height: 100vh; transition: background 0.3s, color 0.3s; }

    .container { max-width: 1000px; margin: 0 auto; }

    .page-header { margin-bottom: 32px; }
    .page-header h1 {
      font-family: 'Syne', sans-serif; font-size: 2.2rem;
      background: linear-gradient(45deg, #10b981, #3b82f6);
      -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
    }
    .page-header p { opacity: .6; margin-top: 6px; font-size: 14px; }

    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      border-radius: 20px; padding: 28px; margin-bottom: 20px;
      box-shadow: var(--shadow); border: 1px solid; transition: box-shadow 0.3s;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    }
    html.light body .card { background: rgba(255,255,255,0.92); border-color: rgba(0,0,0,0.07); }
    html.dark  body .card { background: rgba(25,25,25,0.88); border-color: rgba(255,255,255,0.06); }
    .card:hover { box-shadow: 0 16px 48px rgba(16,185,129,0.15); }
    .card-title {
      font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700;
      margin-bottom: 20px; display: flex; align-items: center; gap: 8px;
    }

    /* ãƒœã‚¿ãƒ³ */
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
    .btn {
      padding: 11px 22px; border: none; border-radius: 10px;
      font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600;
      cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
    }
    .btn:hover { transform: translateY(-2px); opacity: .9; }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-blue    { background: #3b82f6; color: #fff; }
    .btn-orange  { background: #f59e0b; color: #fff; }
    .btn-gray    { background: #6c757d; color: #fff; }
    .btn-red     { background: #ef4444; color: #fff; }

    /* ãƒãƒƒãƒ— */
    .chip-wrap { display: flex; flex-wrap: wrap; gap: 7px; margin-bottom: 16px; }
    .chip {
      padding: 5px 14px; border-radius: 20px; font-size: 13px; font-weight: 600;
      border: 2px solid rgba(16,185,129,0.3); background: transparent; color: inherit;
      cursor: pointer; transition: all 0.2s; user-select: none; font-family: 'DM Sans', sans-serif;
    }
    .chip.active { background: var(--primary); border-color: var(--primary); color: #fff; }
    .chip:hover:not(.active) { border-color: var(--primary); background: rgba(16,185,129,0.1); }

    /* äººæ•°é¸æŠ */
    .count-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
    .count-chip {
      padding: 8px 20px; border-radius: 20px; font-size: 14px; font-weight: 700;
      border: 2px solid rgba(16,185,129,0.35); background: transparent; color: inherit;
      cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif;
    }
    .count-chip.active { background: var(--primary); border-color: var(--primary); color: #fff; }

    /* ã‚­ãƒ£ãƒ©ã‚«ãƒ¼ãƒ‰ */
    .chara-cards { display: flex; flex-direction: column; gap: 20px; }
    .chara-card {
      border: 2px solid rgba(16,185,129,0.2);
      border-radius: 16px; padding: 20px;
      background: rgba(16,185,129,0.04);
      position: relative;
    }
    .chara-card-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 14px;
    }
    .chara-card-title {
      font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700;
      display: flex; align-items: center; gap: 8px;
    }
    .chara-lock-btn {
      padding: 5px 12px; border: 2px solid rgba(245,158,11,0.4);
      border-radius: 20px; background: transparent; color: inherit;
      font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;
      font-family: 'DM Sans', sans-serif;
    }
    .chara-lock-btn.locked { background: rgba(245,158,11,0.15); border-color: #f59e0b; color: #f59e0b; }

    .chara-attrs {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
    }
    .attr-box {
      background: rgba(16,185,129,0.07);
      border: 1px solid rgba(16,185,129,0.15);
      border-radius: 10px; padding: 12px;
    }
    .attr-box h5 {
      font-size: 10px; font-weight: 700; letter-spacing: .07em;
      opacity: .5; text-transform: uppercase; margin-bottom: 5px;
    }
    .attr-box .attr-val { font-size: 13px; font-weight: 600; line-height: 1.4; }

    /* ç©ºçŠ¶æ…‹ */
    .empty-state {
      text-align: center; padding: 48px 20px; opacity: .45; font-size: 15px;
    }
    .empty-state .icon { font-size: 48px; margin-bottom: 12px; }

    /* ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ› */
    .text-output {
      background: rgba(16,185,129,0.06); border: 2px dashed rgba(16,185,129,0.2);
      border-radius: 14px; padding: 16px; font-size: 13px; line-height: 1.8;
      white-space: pre-wrap; min-height: 60px; max-height: 300px; overflow-y: auto;
      font-family: 'DM Mono', monospace;
    }

    /* å±¥æ­´ */
    .history-list { display: flex; flex-direction: column; gap: 8px; max-height: 240px; overflow-y: auto; }
    .history-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 14px; border-radius: 10px;
      background: rgba(16,185,129,0.06); border: 1px solid rgba(16,185,129,0.12);
      font-size: 13px; gap: 10px;
    }
    .history-item .hist-text { flex: 1; opacity: .8; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .history-item .hist-copy {
      padding: 4px 10px; border: none; border-radius: 6px;
      background: var(--primary); color: #fff; font-size: 12px; font-weight: 600;
      cursor: pointer; white-space: nowrap; font-family: 'DM Sans', sans-serif;
      flex-shrink: 0;
    }

    /* ãƒˆãƒ¼ã‚¹ãƒˆ */
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.85); color: #fff; padding: 12px 24px;
      border-radius: 50px; opacity: 0; pointer-events: none; transition: all 0.3s; z-index: 2000;
    }
    .toast.show { opacity: 1; bottom: 42px; }

    @media (max-width: 600px) {
      .page-header h1 { font-size: 1.7rem; }
      .chara-attrs { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
  <script>
    (function(){
      const t = localStorage.getItem("theme") ||
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      document.documentElement.className = t;
    })();
  </script>
</head>
<body>

<div id="mainNav"></div>
<div id="toast" class="toast"></div>

<div class="container">
  <div class="page-header">
    <h1>ğŸ‘¥ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ§‹æˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p>ã‚¤ãƒ©ã‚¹ãƒˆãƒ»ãƒãƒ³ã‚¬ãƒ»å°èª¬ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã—ã¾ã™</p>
  </div>

  <!-- ========== è¨­å®š ========== -->
  <div class="card">
    <div class="card-title">âš™ï¸ ç”Ÿæˆè¨­å®š</div>

    <div style="font-size:13px;font-weight:600;margin-bottom:10px;">äººæ•°</div>
    <div class="count-chips" id="countChips">
      <button class="count-chip active" data-n="1">1äºº</button>
      <button class="count-chip" data-n="2">2äºº</button>
      <button class="count-chip" data-n="3">3äºº</button>
      <button class="count-chip" data-n="4">4äºº</button>
      <button class="count-chip" data-n="5">5äºº</button>
      <button class="count-chip" data-n="random">ğŸ² ãƒ©ãƒ³ãƒ€ãƒ </button>
    </div>

    <div style="font-size:13px;font-weight:600;margin-bottom:10px;">ç”Ÿæˆã™ã‚‹å±æ€§</div>
    <div class="chip-wrap" id="attrChipWrap">
      <button class="chip active" data-attr="role">ğŸ­ å½¹å‰²</button>
      <button class="chip active" data-attr="gender">âš§ æ€§åˆ¥</button>
      <button class="chip active" data-attr="age">ğŸ‚ å¹´é½¢</button>
      <button class="chip active" data-attr="personality">ğŸ’¬ æ€§æ ¼</button>
      <button class="chip active" data-attr="feature">ğŸ‘ï¸ å¤–è¦‹ã®ç‰¹å¾´</button>
      <button class="chip active" data-attr="hairColor">ğŸ’ˆ é«ªè‰²</button>
      <button class="chip active" data-attr="outfit">ğŸ‘— æœè£…</button>
      <button class="chip active" data-attr="weapon">âš”ï¸ æ­¦å™¨ãƒ»é“å…·</button>
      <button class="chip" data-attr="ability">âœ¨ èƒ½åŠ›ãƒ»ã‚¹ã‚­ãƒ«</button>
      <button class="chip" data-attr="background">ğŸ“– èƒŒæ™¯ãƒ»éå»</button>
      <button class="chip" data-attr="weakness">ğŸ’” å¼±ç‚¹</button>
      <button class="chip" data-attr="quote">ğŸ’­ å£ç™–ãƒ»ã‚»ãƒªãƒ•</button>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="generateCharas()">ğŸ² ã‚­ãƒ£ãƒ©æ§‹æˆã‚’ç”Ÿæˆ</button>
      <button class="btn btn-blue"    onclick="regenUnlocked()">ğŸ”„ ãƒ­ãƒƒã‚¯å¤–ã‚’å†ç”Ÿæˆ</button>
      <button class="btn btn-gray"    onclick="copyAllText()">ğŸ“‹ å…¨å“¡ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>

  <!-- ========== çµæœ ========== -->
  <div class="card">
    <div class="card-title">ğŸ‘¥ ç”Ÿæˆçµæœ</div>
    <div id="charaCards">
      <div class="empty-state">
        <div class="icon">ğŸ‘¥</div>
        <div>ã€Œã‚­ãƒ£ãƒ©æ§‹æˆã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
      </div>
    </div>
  </div>

  <!-- ========== ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ› ========== -->
  <div class="card">
    <div class="card-title">ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›ï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰</div>
    <div class="text-output" id="textOutput">ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    <div style="margin-top:12px;">
      <button class="btn btn-gray" onclick="copyAllText()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>

  <!-- ========== å±¥æ­´ ========== -->
  <div class="card">
    <div class="card-title">ğŸ“ ç”Ÿæˆå±¥æ­´ï¼ˆç›´è¿‘5ä»¶ï¼‰</div>
    <div class="history-list" id="historyList">
      <div style="opacity:.45;font-size:13px;">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
    </div>
  </div>
</div>

<script src="auth.js"></script>
<script src="common.js"></script>
<script>
// ==================== ãƒ‡ãƒ¼ã‚¿ ====================
const CHARA_DATA = {
  role: ['ä¸»äººå…¬','ãƒ©ã‚¤ãƒãƒ«','è¦ªå‹ãƒ»ç›¸æ£’','å¸«åŒ ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼','ãƒ´ã‚£ãƒ©ãƒ³ï¼ˆæ•µå½¹ï¼‰','è¬ã®äººç‰©','ã‚³ãƒ¡ãƒ‡ã‚£ãƒªãƒªãƒ¼ãƒ•','ã‚µãƒãƒ¼ã‚¿ãƒ¼','ãƒ’ãƒ¼ãƒ«ï¼ˆæ‚ªå½¹ï¼‰','éš ã‚ŒãŸå”åŠ›è€…','è£åˆ‡ã‚Šè€…','è–è·è€…','æ¢åµãƒ»èª¿æŸ»è€…','ç§‘å­¦è€…','å‹‡è€…','é­”ç‹','ç‹æ—','å‚­å…µ','å¿è€…','æµ·è³Š'],
  gender: ['å¥³æ€§','ç”·æ€§','ãƒãƒ³ãƒã‚¤ãƒŠãƒªãƒ¼','ä¸æ˜ãƒ»ç„¡æ€§','æ€§åˆ¥ä¸è©³'],
  age: ['å¹¼å…ï¼ˆã€œ6æ­³ï¼‰','å­ã©ã‚‚ï¼ˆ7ã€œ12æ­³ï¼‰','å°‘å¹´å°‘å¥³ï¼ˆ13ã€œ15æ­³ï¼‰','é’å¹´ï¼ˆ16ã€œ20æ­³ï¼‰','è‹¥è€…ï¼ˆ20ä»£ï¼‰','å¤§äººï¼ˆ30ã€œ40ä»£ï¼‰','å£®å¹´ï¼ˆ50ã€œ60ä»£ï¼‰','è€äººï¼ˆ70æ­³ã€œï¼‰','ä¸è€ï¼ˆå®Ÿå¹´é½¢ä¸æ˜ï¼‰'],
  personality: ['å…ƒæ°—ãƒ»æ´»ç™º','ã‚¯ãƒ¼ãƒ«ãƒ»å†·é™','å¤©ç„¶ãƒ»ãŠã£ã¨ã‚Š','ãƒ„ãƒ³ãƒ‡ãƒ¬','ç†±è¡€ãƒ»æƒ…ç†±çš„','çŸ¥çš„ãƒ»ç­–å£«','å†…å‘çš„ãƒ»ç¹Šç´°','ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹','ãŠã¡ã‚ƒã‚‰ã‘ãƒ»ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼','çœŸé¢ç›®ãƒ»å‡ å¸³é¢','ãŠäººå¥½ã—','æ¯’èˆŒå®¶','é ‘å›ºè€…','ç´”ç²‹ç„¡å¢','äºŒé‡äººæ ¼ï¼ˆè¡¨ã¨è£ï¼‰','æ‚²è¦³çš„ãƒ»è‡ªå·±å«Œæ‚ª','æ¥½å¤©å®¶','è…¹é»’','éˆæ„Ÿ','éä¿è­·'],
  feature: ['é•·ã„é»’é«ª','ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ','ãƒ„ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ«','ãƒãƒ‹ãƒ¼ãƒ†ãƒ¼ãƒ«','ãƒ‰ãƒ¬ãƒƒãƒ‰ãƒ˜ã‚¢','ä¸‰ã¤ç·¨ã¿','ã‚ªãƒ¼ãƒ«ãƒãƒƒã‚¯','ã‚¦ã‚§ãƒ¼ãƒ–ãŒã‹ã£ãŸé«ª','å¤©ç„¶ãƒ‘ãƒ¼ãƒ','å¸½å­ã‚’ã‹ã¶ã£ã¦ã„ã‚‹','çœ¼é¡','çœ¼å¸¯','å‚·è·¡ï¼ˆé¡”ï¼‰','å‚·è·¡ï¼ˆä½“ï¼‰','ã‚¿ãƒˆã‚¥ãƒ¼','çŒ«è€³','ç£è€³','ç¿¼ï¼ˆç¾½ï¼‰','å°»å°¾','è§’ï¼ˆãƒ„ãƒï¼‰','çˆªãŒé‹­ã„','ç¾©æ‰‹ãƒ»ç¾©è¶³','åŒ…å¸¯'],
  hairColor: ['é»’é«ª','èŒ¶é«ª','é‡‘é«ª','ç™½é«ªï¼ˆéŠ€é«ªï¼‰','èµ¤é«ª','é’é«ª','ç´«é«ª','ãƒ”ãƒ³ã‚¯é«ª','ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³','ã‚°ãƒ¬ãƒ¼','ç·‘é«ª','ãƒ„ãƒ¼ãƒˆãƒ¼ãƒ³'],
  outfit: ['å­¦ç”Ÿåˆ¶æœ','ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆæ™®æ®µç€ï¼‰','ãƒ•ã‚©ãƒ¼ãƒãƒ«ã‚¹ãƒ¼ãƒ„','ãƒ•ãƒ«é§ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒˆã‚¢ãƒ¼ãƒãƒ¼ï¼‰','é©é§','é­”æ³•ä½¿ã„ã®ãƒ­ãƒ¼ãƒ–','å’Œæœï¼ˆç€ç‰©ãƒ»è¢´ï¼‰','å¿è€…è£…æŸ','ã‚¹ãƒãƒ¼ãƒ„ã‚¦ã‚§ã‚¢','ãƒ¡ã‚«ã‚¹ãƒ¼ãƒ„','ãƒœãƒ­ãƒœãƒ­ã®æœ','é«˜è²´ãªè¡£è£…','æµ·è³Šæœ','è–è·è€…ã®æœ','æ¢åµã‚³ãƒ¼ãƒˆ','è»æœ','ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹','ç™½è¡£','ã‚¹ãƒ¼ãƒ„ï¼ˆã‚µã‚¤ãƒãƒ¼ï¼‰','ãƒ•ãƒ¼ãƒ‰ä»˜ããƒãƒ³ãƒˆ'],
  weapon: ['ãªã—ï¼ˆç´ æ‰‹ï¼‰','å‰£ï¼ˆç›´å‰£ï¼‰','å¤§å‰£ï¼ˆä¸¡æ‰‹å‰£ï¼‰','åˆ€ï¼ˆæ—¥æœ¬åˆ€ï¼‰','çŸ­å‰£ï¼ˆãƒ€ã‚¬ãƒ¼ï¼‰','å¼“','ã‚¯ãƒ­ã‚¹ãƒœã‚¦','æ§','è–™åˆ€','æ–§','éŒ','ç›¾ï¼ˆé˜²å¾¡ä¸»ä½“ï¼‰','é­”æ³•æ–','é­”æ³•æ›¸ï¼ˆã‚°ãƒªãƒ¢ãƒ¯ãƒ¼ãƒ«ï¼‰','éŠƒï¼ˆæ‹³éŠƒï¼‰','ãƒ©ã‚¤ãƒ•ãƒ«','æ©Ÿé–¢éŠƒ','çˆ†ç™ºç‰©','é­','æ‰‡','ç³¸ãƒ»ç¸„','æ¥½å™¨ï¼ˆæ­¦å™¨åŒ–ï¼‰','é“å…·ï¼ˆéæˆ¦é—˜ï¼‰'],
  ability: ['å‰£è¡“ã®é”äºº','é­”æ³•ä½¿ã„ï¼ˆæ±ç”¨ï¼‰','ç‚é­”æ³•','æ°´ãƒ»æ°·é­”æ³•','é›·é­”æ³•','é¢¨é­”æ³•','åœŸé­”æ³•','å…‰ãƒ»è–é­”æ³•','é—‡ãƒ»å‘ªé­”æ³•','æ²»ç™’é­”æ³•','å¹»æƒ‘é­”æ³•','äºˆçŸ¥èƒ½åŠ›','å¿µå‹•åŠ›ï¼ˆãƒ†ãƒ¬ã‚­ãƒã‚·ã‚¹ï¼‰','è¶…é€Ÿç§»å‹•','å¼·åŒ–èº«ä½“èƒ½åŠ›','ã‚¹ãƒ†ãƒ«ã‚¹ï¼ˆé€æ˜åŒ–ï¼‰','å¤‰èº«èƒ½åŠ›','å‹•ç‰©ã¨è©±ã›ã‚‹','æ™‚é–“æ“ä½œï¼ˆé™å®šï¼‰','å¬å–šè¡“','éŒ¬é‡‘è¡“','ç™ºæ˜ãƒ»æ©Ÿæ¢°å·¥å­¦','æ ¼é—˜è¡“ï¼ˆæ­¦é“ï¼‰'],
  background: ['å¾©è®ã®ãŸã‚ã«æˆ¦ã†','å¤±ã‚ã‚ŒãŸè¨˜æ†¶ã‚’æ¢ã™','å®¶æ—ã‚’å®ˆã‚‹ãŸã‚','ä½¿å‘½ã‚’æœãŸã™ãŸã‚æ—…ã«å‡ºãŸ','å…ƒãƒ»æ•µå´ã®çµ„ç¹”å“¡','å­¤ç‹¬ãªæµã‚Œè€…','åå®¶ã®è½ã¡ã“ã¼ã‚Œ','è©¦ç·´ã«æŒ‘ã‚€è¦‹ç¿’ã„','éå»ã«å¤§ããªå¤±æ•—ã‚’çŠ¯ã—ãŸ','éš ã•ã‚ŒãŸå‡ºç”Ÿã®ç§˜å¯†ãŒã‚ã‚‹','ã‹ã¤ã¦ã¯è‹±é›„ã ã£ãŸ','ä¸€èˆ¬äººãŒçªç„¶å·»ãè¾¼ã¾ã‚ŒãŸ','é ã„æœªæ¥ãƒ»éå»ã‹ã‚‰æ¥ãŸ','åˆ¥ã®ä¸–ç•Œã‹ã‚‰ã®æ¥è¨ªè€…'],
  weakness: ['é«˜æ‰€ææ€–ç—‡','æ°´ï¼ˆæ³³ã’ãªã„ï¼‰','ç‰¹å®šã®é­”æ³•å±æ€§ã«å¼±ã„','ä»²é–“ã®ã“ã¨ã«ãªã‚‹ã¨åˆ¤æ–­ãŒéˆã‚‹','ãƒ—ãƒ©ã‚¤ãƒ‰ãŒé«˜ã™ãã‚‹','ä½“åŠ›ã¯ä½ã„','ç‰¹å®šã®é£Ÿã¹ç‰©ãŒè‹¦æ‰‹','éå»ã®ãƒˆãƒ©ã‚¦ãƒ','å¯‚ã—ãŒã‚Šã‚„','ç–‘ã‚Šæ·±ã™ãã¦å‘³æ–¹ã‚’ä¿¡ã˜ãªã„'],
  quote: ['"è«¦ã‚ãŸã‚‰ãã“ã§çµ‚ã‚ã‚Šã "','"ç§ã«ã¯é–¢ä¿‚ãªã„â€¦"','"é¢ç™½ããªã£ã¦ããŸãª"','"ã†ã‚‹ã•ã„ã†ã‚‹ã•ã„ã†ã‚‹ã•ã„ï¼"','"â€¦ï¼ˆç„¡è¨€ï¼‰"','"è¨ˆç®—é€šã‚Šã "','"ãªãœã â€¦ãªãœåŠ›ãŒè¶³ã‚Šãªã„"','"ç¬‘ãˆã‚Œã°ãã‚Œã§ã„ã„"','"çµ¶å¯¾ã«å®ˆã£ã¦ã¿ã›ã‚‹"','"ãŠå‰ã®ã“ã¨ã¯å«Œã„ã§ã¯ãªã„"','"ã“ã‚ŒãŒç§ã®ç”Ÿãæ–¹ã "','"ã¾ã ã ã€ã¾ã çµ‚ã‚ã‚‰ã›ãªã„ï¼"'],
};

// ==================== çŠ¶æ…‹ ====================
let charaStates = []; // { data: {}, locked: bool }
let history = [];
let selectedCount = 1;

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

// ==================== äººæ•°ãƒãƒƒãƒ— ====================
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('#countChips .count-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      document.querySelectorAll('#countChips .count-chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      selectedCount = chip.dataset.n;
    });
  });
  document.querySelectorAll('#attrChipWrap .chip').forEach(chip => {
    chip.addEventListener('click', () => chip.classList.toggle('active'));
  });
});

function getCount() {
  const v = selectedCount;
  if (v === 'random') return Math.floor(Math.random() * 5) + 1;
  return parseInt(v);
}

function getActiveAttrs() {
  return [...document.querySelectorAll('#attrChipWrap .chip.active')].map(c => c.dataset.attr);
}

// ==================== ã‚­ãƒ£ãƒ©ç”Ÿæˆ ====================
function buildCharaData(attrs) {
  const data = {};
  attrs.forEach(attr => {
    if (CHARA_DATA[attr]) data[attr] = pick(CHARA_DATA[attr]);
  });
  return data;
}

function generateCharas() {
  const count = getCount();
  const attrs = getActiveAttrs();
  if (attrs.length === 0) { showToast('å±æ€§ã‚’1ã¤ä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„'); return; }

  charaStates = [];
  for (let i = 0; i < count; i++) {
    charaStates.push({ data: buildCharaData(attrs), locked: false });
  }
  render();
  saveHistory();
  showToast(`${count}äººã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼`);
}

function regenUnlocked() {
  if (charaStates.length === 0) { showToast('å…ˆã«ç”Ÿæˆã—ã¦ãã ã•ã„'); return; }
  const attrs = getActiveAttrs();
  charaStates.forEach((c, i) => {
    if (!c.locked) charaStates[i].data = buildCharaData(attrs);
  });
  render();
  showToast('ãƒ­ãƒƒã‚¯å¤–ã®ã‚­ãƒ£ãƒ©ã‚’å†ç”Ÿæˆã—ã¾ã—ãŸ');
}

// ==================== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ====================
const ATTR_LABELS = {
  role: 'å½¹å‰²', gender: 'æ€§åˆ¥', age: 'å¹´é½¢', personality: 'æ€§æ ¼',
  feature: 'å¤–è¦‹ã®ç‰¹å¾´', hairColor: 'é«ªè‰²', outfit: 'æœè£…', weapon: 'æ­¦å™¨ãƒ»é“å…·',
  ability: 'èƒ½åŠ›ãƒ»ã‚¹ã‚­ãƒ«', background: 'èƒŒæ™¯ãƒ»éå»', weakness: 'å¼±ç‚¹', quote: 'å£ç™–',
};
const CHARA_ICONS = ['ğŸŸ¦','ğŸŸ¥','ğŸŸ¨','ğŸŸ©','ğŸŸª'];

function render() {
  const el = document.getElementById('charaCards');
  if (charaStates.length === 0) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘¥</div><div>ã€Œã‚­ãƒ£ãƒ©æ§‹æˆã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div></div>';
    return;
  }

  el.innerHTML = '<div class="chara-cards">' + charaStates.map((c, i) => `
    <div class="chara-card" id="chara-${i}">
      <div class="chara-card-header">
        <div class="chara-card-title">
          <span>${CHARA_ICONS[i % CHARA_ICONS.length]}</span>
          ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ ${i + 1}
          ${c.data.role ? `<span style="font-size:12px;opacity:.6;font-family:'DM Sans',sans-serif;font-weight:400;">ï¼ˆ${c.data.role}ï¼‰</span>` : ''}
        </div>
        <button class="chara-lock-btn ${c.locked ? 'locked' : ''}"
          onclick="toggleLock(${i})">
          ${c.locked ? 'ğŸ”’ ãƒ­ãƒƒã‚¯ä¸­' : 'ğŸ”“ ãƒ­ãƒƒã‚¯è§£é™¤'}
        </button>
      </div>
      <div class="chara-attrs">
        ${Object.entries(c.data).map(([k, v]) => `
          <div class="attr-box">
            <h5>${ATTR_LABELS[k] || k}</h5>
            <div class="attr-val">${v}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `).join('') + '</div>';

  // ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›æ›´æ–°
  updateTextOutput();
}

function toggleLock(i) {
  charaStates[i].locked = !charaStates[i].locked;
  render();
  showToast(charaStates[i].locked ? `ğŸ”’ ã‚­ãƒ£ãƒ©${i+1}ã‚’ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸ` : `ğŸ”“ ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¾ã—ãŸ`);
}

function updateTextOutput() {
  const text = charaStates.map((c, i) => {
    const lines = Object.entries(c.data).map(([k, v]) => `  ${ATTR_LABELS[k] || k}: ${v}`);
    return `ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼${i+1}ã€‘\n${lines.join('\n')}`;
  }).join('\n\n');
  document.getElementById('textOutput').textContent = text;
}

function copyAllText() {
  const text = document.getElementById('textOutput').textContent;
  if (!text || text === 'ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤ºã•ã‚Œã¾ã™') { showToast('å…ˆã«ç”Ÿæˆã—ã¦ãã ã•ã„'); return; }
  navigator.clipboard.writeText(text);
  showToast('å…¨å“¡ã®æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
}

// ==================== å±¥æ­´ ====================
function saveHistory() {
  const summary = charaStates.map((c, i) => `ã‚­ãƒ£ãƒ©${i+1}: ${c.data.role || '?'} / ${c.data.personality || '?'}`).join(' ï½œ ');
  history.unshift({ summary, full: document.getElementById('textOutput').textContent, time: new Date().toLocaleTimeString('ja-JP') });
  if (history.length > 5) history.pop();
  renderHistory();
}

function renderHistory() {
  const el = document.getElementById('historyList');
  if (history.length === 0) {
    el.innerHTML = '<div style="opacity:.45;font-size:13px;">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
    return;
  }
  el.innerHTML = history.map(h => `
    <div class="history-item">
      <div class="hist-text">
        <span style="opacity:.5;font-size:11px;margin-right:6px;">${h.time}</span>
        ${h.summary}
      </div>
      <button class="hist-copy" onclick="navigator.clipboard.writeText(\`${h.full.replace(/`/g, "'")}\`);showToast('ã‚³ãƒ”ãƒ¼ï¼')">ğŸ“‹</button>
    </div>
  `).join('');
}

// ==================== ãƒˆãƒ¼ã‚¹ãƒˆ ====================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._t);
  t._t = setTimeout(() => t.classList.remove('show'), 2200);
}

// ==================== åˆæœŸåŒ– ====================
window.onload = () => {
  const user = requireAuth();
  if (!user) return;
  injectCommonStyles();
  buildNav('chara');
};
</script>
</body>
</html>
